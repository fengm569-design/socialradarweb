<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç¤¾ä¼šé›·è¾¾ Social Radar</title>
<meta name="description" content="ä¸€ä¸ªç”¨äºå±•ç¤ºä¸åŸå‹éªŒè¯çš„ç¤¾ä¼šé›·è¾¾å•é¡µç«™ç‚¹ï¼šæ•°æ®ç®¡é“ã€æƒé‡é¢‘ç§»è®¡ç®—ã€å¯è§†åŒ–ä¸ä¸‹è½½ã€‚" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body,{delimiters:[
          {left:'$$', right:'$$', display:true},
          {left:'\\[', right:'\\]', display:true},
          {left:'$', right:'$', display:false},
          {left:'\\(', right:'\\)', display:false}
        ]});"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f9fafb; /* èƒŒæ™¯ï¼šæµ…è‰² */
  --panel:#ffffff; /* é¢æ¿ */
  --muted:#4b5563; /* æ¬¡çº§æ–‡æœ¬ */
  --text:#111827; /* ä¸»æ–‡æœ¬ */
  --accent:#0ea5e9; /* å¼ºè°ƒè‰²ï¼šè“ */
  --accent2:#7c3aed; /* æ¬¡å¼ºè°ƒï¼šç´« */
  --border:#e5e7eb; /* è¾¹æ¡† */
  --card:#ffffff; /* å¡ç‰‡åº• */
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}
img{max-width:100%;display:block}
.container{max-width:1080px;margin:0 auto;padding:24px}
header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);z-index:10}
.nav{display:flex;align-items:center;justify-content:space-between}
.brand{font-weight:800;letter-spacing:.3px}
.menu{display:flex;gap:14px}
.menu a{padding:10px 12px;border-radius:10px}
.menu a:hover{background:rgba(0,0,0,.06)}
.hero{padding:68px 0 28px}
.hero h1{font-size:40px;margin:8px 0}
.hero p{color:var(--muted);max-width:760px}
.btns{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
.btn{display:inline-block;padding:10px 14px;border-radius:12px;background:var(--accent);color:#fff;font-weight:800;border:none;cursor:pointer;}
.btn.secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
section{padding:36px 0;border-top:1px solid var(--border)}
h2{margin:0 0 14px;font-size:22px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.col-6{grid-column:span 6}
.col-4{grid-column:span 4}
.col-8{grid-column:span 8}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.05)}
.muted{color:var(--muted)}
footer{padding:28px 0;color:var(--muted)}
code,kbd{background:#f3f4f6;color:#1f2937;padding:2px 6px;border-radius:8px}
.badge{display:inline-block;border:1px solid var(--border);padding:4px 8px;border-radius:999px;color:var(--muted);font-size:12px}
.pill{display:inline-block;padding:2px 8px;border-radius:6px;background:var(--bg);border:1px solid var(--border);margin-right:6px;font-size:12px;color:var(--accent)}
.flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.table{width:100%;border-collapse:collapse;font-size:14px}
.table th,.table td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left}
.drop{border:1px dashed var(--border);border-radius:14px;padding:16px;background:var(--bg)}

@media (max-width:900px){.col-6,.col-4,.col-8{grid-column:span 12}.hero{padding-top:48px}.hero h1{font-size:32px}}
.legend{display:flex;gap:10px;align-items:center}
.legend span{display:inline-block;width:12px;height:12px;border-radius:3px;background:var(--accent)}

/* æ·±è‰²ä¸»é¢˜å˜é‡ä¸è¦†ç›– */
[data-theme="dark"]{
  --bg:#0b1220;
  --panel:#0e1627;
  --muted:#93a3b8;
  --text:#e6eef8;
  --accent:#38bdf8;
  --accent2:#a78bfa;
  --border:#1e293b;
  --card:#0b1530;
}
[data-theme="dark"] header{background:rgba(11,18,32,.7)}
[data-theme="dark"] .menu a:hover{background:rgba(255,255,255,.06)}
</style>
</head>
<body>

  <header>
    <div class="container nav">
      <div class="brand">ç¤¾ä¼šé›·è¾¾ Â· Social Radar</div>
      <nav class="menu">
        <a href="#about">æ¦‚å¿µ</a>
        <a href="#results">çŸ¥ä¹æ•°æ®</a>
        <a href="#analyze">CSVåˆ†æ</a>
        <a href="#papers">ç›¸å…³è®ºæ–‡</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero" id="home">
      <p class="muted">Social Sensing | Doppler-like Shift | Weighted Signals</p>
      <h1>ç¤¾ä¼šé›·è¾¾</h1>
      <p>
        æœ¬é¡µæä¾›ä¸€ä¸ªå¯ç›´æ¥éƒ¨ç½²åˆ° GitHub çš„<strong>åŸå‹ç«™ç‚¹</strong>ã€‚æ‰€æœ‰è®¡ç®—å‡åœ¨å‰ç«¯å®Œæˆã€‚
      </p>
      <div class="btns">
        <a class="btn" href="#results">æŸ¥çœ‹æ•°æ®</a>
        <a class="btn secondary" href="#analyze">ä¸Šä¼  CSV</a>
      </div>
    </section>

    <section id="about">
      <h2>æ¦‚å¿µç®€è¿°</h2>
      <div class="grid">
        <div class="col-6 card">
          <p class="muted">æ ¸å¿ƒæ€æƒ³ï¼š</p>
          <p>ç¤¾ä¼šèˆ†è®ºå¦‚åŒç‰©ç†æ³¢ï¼Œå…·å¤‡å¤šæ™®å‹’æ•ˆåº”ã€‚å½“ç¾¤ä½“æ³¨æ„åŠ›å¿«é€Ÿèšç„¦æŸä¸€äº‹ä»¶æ—¶ï¼Œä¿¡å·é¢‘ç‡å‘ç”Ÿåç§»ã€‚</p>
          <p class="muted">åŸå‹å…¬å¼ï¼š</p>$$f_{d,s}=\frac{v_s}{f_0} \cdot \Delta S$$
        </div>
        <div class="col-6 card">
           <h3 style="margin-top:0">æ•°æ®æµå‘</h3>
           <ul>
             <li>1. æŠ“å– (GitHub Actions) -> CSV</li>
             <li>2. å‰ç«¯åŠ è½½ -> <strong>æœ¬åœ°è®¡ç®—</strong></li>
             <li>3. å¯è§†åŒ–æ¸²æŸ“ (Chart.js)</li>
           </ul>
        </div>
      </div>
    </section>

    <section id="results">
      <h2>çŸ¥ä¹æŠ“å–ç»“æœ</h2>

      <div class="card" style="margin-bottom: 20px;">
        <div class="flex" style="justify-content: space-between; margin-bottom: 10px;">
           <h3 style="margin:0; font-size:16px;">ğŸ“Š å…³é”®è¯çƒ­åº¦ / è¯é¢˜åˆ†å¸ƒ</h3>
           <small class="muted">åŸºäºæŠ“å–æ¬¡æ•°ç»Ÿè®¡</small>
        </div>
        
        <div style="position: relative; height: 260px; width: 100%;">
          <canvas id="authorChart"></canvas>
        </div>
      </div>

      <div class="card">
        <div class="flex" style="justify-content:space-between;align-items:center">
          <div class="muted" id="resultsMeta">Loading...</div>

          <input
            id="kwFilter"
            placeholder="æŒ‰å…³é”®è¯è¿‡æ»¤ï¼ˆå›è½¦ç”Ÿæ•ˆï¼‰"
            style="padding:8px 10px;border-radius:10px;border:1px solid var(--border);
                   background:var(--panel);color:var(--text);min-width:220px"
          />
        </div>

        <div id="resultsList" style="margin-top:12px">Loading...</div>
      </div>

      <p class="muted" style="margin-top:10px">
        æ•°æ®æ¥æºï¼šä»“åº“ data/zhihu_data.csv
      </p>
    </section>

    <section id="analyze">
      <h2>CSV ä¸Šä¼ ä¸åˆ†æ</h2>
      <div class="card">
        <p class="muted">å¦‚æœæ‚¨æœ‰è‡ªå®šä¹‰çš„ CSV æ•°æ®ï¼ˆæ ¼å¼ï¼štimestamp, value, userï¼‰ï¼Œå¯åœ¨æ­¤ä¸Šä¼ è¿›è¡Œå¤šæ™®å‹’é¢‘ç§»æ¨¡æ‹Ÿã€‚</p>
        <div class="drop" id="drop">
          <input id="file" type="file" accept=".csv" />
        </div>
        <canvas id="chart" width="1024" height="300" style="width:100%;margin-top:10px;border:1px solid var(--border);border-radius:12px;background:#f9fafb"></canvas>
        <div class="flex" style="margin-top:10px">
          <a id="download" class="btn secondary" href="#" style="padding:8px 12px; display:none">ä¸‹è½½ç»“æœ CSV</a>
        </div>
      </div>
    </section>

    <section id="papers">
      <h2>æˆ‘ä»¬çš„å·¥ä½œ</h2>
      <div class="grid">
        <div class="col-6 card">
          <article>
            <h3 style="margin:0 0 6px">Social Radars for Social Vision</h3>
            <p class="muted">IEEE Transactions on Intelligent Vehicles</p>
          </article>
        </div>
        <div class="col-6 card">
          <article>
            <h3 style="margin:0 0 6px">Social Doppler Framework</h3>
            <p class="muted">ArXiv Preprint</p>
          </article>
        </div>
      </div>
    </section>

    <footer>
      <div class="container">
        <small class="muted">Â© 2025 ç¤¾ä¼šé›·è¾¾ Â· ç ”ç©¶åŸå‹é¡µé¢ã€‚</small>
      </div>
    </footer>
  </main>

<script>


// 1. å…¨å±€å˜é‡
let authorChartInstance = null; // ç”¨äºå­˜å‚¨ Chart.js å®ä¾‹

// 2. å·¥å…·å‡½æ•°ï¼šCSV è§£æ
// ç®€å•çš„ CSV è§£æå™¨ï¼Œå¤„ç†é€—å·åˆ†éš”ï¼Œå‡è®¾æ²¡æœ‰å¤æ‚çš„åµŒå¥—å¼•å·
function parseCSV(text) {
  const lines = text.trim().split('\n');
  if (lines.length < 2) return [];
  
  // è·å–è¡¨å¤´å¹¶å»é™¤ç©ºæ ¼
  const headers = lines[0].split(',').map(h => h.trim());
  
  const result = [];
  
  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;
    
   
    const values = [];
    let match;
    // åŒ¹é…åŒå¼•å·å†…çš„å†…å®¹ OR ä¸åŒ…å«é€—å·çš„å†…å®¹
    const regex = /(?:,|\n|^)("(?:(?:"")*[^"]*)*"|[^",\n]*|(?:\n|$))/g;
    
    
    const rowData = {};
    const currentLineValues = line.split(','); 
    
    
    
    headers.forEach((header, index) => {
      // ç§»é™¤å¯èƒ½å­˜åœ¨çš„å¼•å·
      let val = currentLineValues[index] || "";
      val = val.replace(/^"|"$/g, ''); 
      rowData[header] = val;
    });

    
    const matches = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
    
    
    result.push(rowData);
  }
  return result;
}

// è¾…åŠ©ï¼šè·å– JSON (ä¿ç•™ç”¨äº meta)
async function fetchJson(url){
  const res = await fetch(url + "?t=" + Date.now(), { cache: "no-store" });
  if(!res.ok) throw new Error("Fetch failed: " + res.status);
  return await res.json();
}

function escapeHtml(s){
  return (s || "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

// 3. ã€ä¿®æ”¹ã€‘æ›´æ–°å›¾è¡¨å‡½æ•°ï¼šå…³è” Keyword
function updateChart(rows) {
  // ç»Ÿè®¡ keyword å‡ºç°é¢‘æ¬¡
  const counts = {};
  rows.forEach(r => {
    // ä½¿ç”¨ keyword å­—æ®µ
    const key = r.keyword ? r.keyword.trim() : "æœªåˆ†ç±»";
    counts[key] = (counts[key] || 0) + 1;
  });

  // æ’åºå¹¶å– Top 10 (æˆ–å…¨éƒ¨ï¼Œå¦‚æœ keyword ä¸å¤š)
  const sortedData = Object.entries(counts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 15); // å±•ç¤ºå‰15ä¸ª

  const labels = sortedData.map(item => item[0]);
  const dataValues = sortedData.map(item => item[1]);

  // è·å–æ ·å¼å˜é‡ç”¨äºå›¾è¡¨é…è‰²
  const style = getComputedStyle(document.documentElement);
  const accentColor = style.getPropertyValue('--accent').trim();
  const textColor = style.getPropertyValue('--muted').trim();

  const ctx = document.getElementById('authorChart').getContext('2d');

  // å¦‚æœæ—§å›¾è¡¨å­˜åœ¨ï¼Œé”€æ¯å®ƒ
  if (authorChartInstance) {
    authorChartInstance.destroy();
  }

  // åˆ›å»ºæ–°å›¾è¡¨
  authorChartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'å…³é”®è¯çƒ­åº¦ (é¢‘æ¬¡)',
        data: dataValues,
        backgroundColor: accentColor,
        borderRadius: 4,
        barThickness: 'flex',
        maxBarThickness: 40
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          mode: 'index',
          intersect: false,
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: style.getPropertyValue('--border').trim() },
          ticks: { color: textColor, stepSize: 1 }
        },
        x: {
          grid: { display: false },
          ticks: { color: textColor }
        }
      }
    }
  });
}

// 4. æ¸²æŸ“åˆ—è¡¨ä¸é¡µé¢ä¸»é€»è¾‘
function renderRows(rows){
  const list = document.getElementById("resultsList");
  const kw = (document.getElementById("kwFilter").value || "").trim().toLowerCase();
   
  // è¿‡æ»¤é€»è¾‘ï¼šåŒ¹é…æ ‡é¢˜ã€ä½œè€…æˆ–å…³é”®è¯
  const filtered = kw ? rows.filter(r => 
    (r.title && r.title.toLowerCase().includes(kw)) ||
    (r.author && r.author.toLowerCase().includes(kw)) ||
    (r.keyword && r.keyword.toLowerCase().includes(kw))
  ) : rows;

  // ã€é‡è¦ã€‘æ›´æ–°åˆ—è¡¨çš„åŒæ—¶ï¼Œæ›´æ–°å›¾è¡¨
  updateChart(filtered);

  // æ¸²æŸ“ HTML åˆ—è¡¨
  list.innerHTML = filtered.slice(0, 50).map(r => `
    <div style="padding:12px 0;border-bottom:1px solid var(--border)">
      <div style="font-weight:800;margin-bottom:6px">
        <a href="${r.url}" target="_blank" rel="noreferrer">${escapeHtml(r.title)}</a>
      </div>
      <div class="muted" style="font-size:12px; display:flex; gap:8px; align-items:center;">
        <span class="pill">${escapeHtml(r.keyword)}</span>
        <span>${escapeHtml(r.author)}</span>
        <span>ğŸ‘ ${escapeHtml(r.upvotes)}</span>
        <span>ğŸ’¬ ${escapeHtml(r.comments)}</span>
      </div>
      <div style="margin-top:6px;line-height:1.6;font-size:14px;color:var(--text);opacity:0.9">
        ${escapeHtml(r.excerpt ? r.excerpt.substring(0, 100) + '...' : '')}
      </div>
    </div>
  `).join("");

  if(filtered.length === 0){
    list.innerHTML = `<div class="muted" style="padding:12px 0">æ²¡æœ‰åŒ¹é…çš„æ•°æ®</div>`;
  }
}

async function loadResults(){
  try{
    const metaEl = document.getElementById("resultsMeta");
    
    // å°è¯•åŠ è½½ Meta æ•°æ® (å¯é€‰)
    try {
        const meta = await fetchJson("./data/meta.json");
        metaEl.textContent = `æ›´æ–°ï¼š${meta.updated_at} | æ€»é‡ï¼š${meta.count}`;
    } catch(e) { 
        metaEl.textContent = "CSV æ•°æ®æ¨¡å¼"; 
    }

    // ã€ä¿®æ”¹ã€‘åŠ è½½ CSV æ•°æ®
    let rows = [];
    try {
        const res = await fetch("./data/zhihu_data.csv?t=" + Date.now());
        if(!res.ok) throw new Error("CSV not found");
        const csvText = await res.text();
        rows = parseCSV(csvText);
    } catch(e) {
        console.warn("æœªæ‰¾åˆ° data/zhihu_data.csvï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ¼”ç¤ºåŠŸèƒ½ã€‚", e);
        // æ¨¡æ‹Ÿæ•°æ®ï¼Œç»“æ„ä¸ CSV ä¸€è‡´
        rows = [
            {keyword: "è‡ªåŠ¨é©¾é©¶", title: "è‡ªåŠ¨é©¾é©¶çš„æœªæ¥åœ¨å“ªé‡Œï¼Ÿ", author: "Elon Musk", upvotes: "1200", comments: "300", excerpt: "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ•°æ®...", url: "#"},
            {keyword: "AI", title: "æ·±åº¦å­¦ä¹ åœ¨ç¤¾ä¼šå­¦ä¸­çš„åº”ç”¨", author: "Yann LeCun", upvotes: "800", comments: "100", excerpt: "å¦ä¸€ä¸ªç¤ºä¾‹...", url: "#"},
            {keyword: "ç¤¾ä¼šé›·è¾¾", title: "ç¤¾ä¼šé›·è¾¾åŸç†è§£æ", author: "SocialRadar Team", upvotes: "50", comments: "5", excerpt: "å¤šæ™®å‹’æ•ˆåº”...", url: "#"},
            {keyword: "è‡ªåŠ¨é©¾é©¶", title: "ç‰¹æ–¯æ‹‰è§†è§‰æ–¹æ¡ˆ", author: "Elon Musk", upvotes: "2000", comments: "500", excerpt: "çº¯è§†è§‰...", url: "#"},
            {keyword: "LLM", title: "GPT-5 ä»€ä¹ˆæ—¶å€™å‘å¸ƒ", author: "Sam Altman", upvotes: "3000", comments: "1000", excerpt: "Soon...", url: "#"},
            {keyword: "AI", title: "OpenAI çš„æ–°åŠ¨æ€", author: "Sam Altman", upvotes: "1500", comments: "200", excerpt: "Q*...", url: "#"},
        ];
    }
    
    renderRows(rows);

    // ç»‘å®šæœç´¢æ¡†äº‹ä»¶
    document.getElementById("kwFilter").addEventListener("input", () => renderRows(rows));

  }catch(e){
    document.getElementById("resultsMeta").textContent = "åŠ è½½å¤±è´¥ï¼š" + e.message;
    console.error(e);
  }
}

// å¯åŠ¨åŠ è½½
loadResults();

// ==================== ä¸»é¢˜åˆ‡æ¢é€»è¾‘ ====================
(function(){
  const KEY = 'theme';
  const root = document.documentElement;
  const saved = localStorage.getItem(KEY);
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
   
  if(saved === 'dark' || (!saved && prefersDark)){
    root.setAttribute('data-theme','dark');
  }

  // æ³¨å…¥æŒ‰é’®
  const menu = document.querySelector('nav.menu');
  if(menu && !document.getElementById('themeToggle')){
    const btn = document.createElement('button');
    btn.id = 'themeToggle';
    btn.className = 'btn secondary';
    btn.textContent = 'ğŸŒ“';
    btn.style.marginLeft = '8px';
    menu.appendChild(btn);
    
    btn.addEventListener('click', ()=>{
      const isDark = root.getAttribute('data-theme') === 'dark';
      if(isDark){
        root.removeAttribute('data-theme');
        localStorage.setItem(KEY,'light');
      }else{
        root.setAttribute('data-theme','dark');
        localStorage.setItem(KEY,'dark');
      }
      // åˆ‡æ¢ä¸»é¢˜åé‡æ–°æ¸²æŸ“å›¾è¡¨ä»¥é€‚é…é¢œè‰²
      loadResults(); 
    });
  }
})();
</script>
</body>
</html>
