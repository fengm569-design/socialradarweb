<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç¤¾ä¼šé›·è¾¾ Social Radar</title>
<meta name="description" content="ç¤¾ä¼šé›·è¾¾åŸå‹ï¼šåŸºäºå¤šæ™®å‹’æ•ˆåº”çš„èˆ†è®ºæ„ŸçŸ¥ä¸å¯è§†åŒ–ã€‚" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body,{delimiters:[{left:'$$', right:'$$', display:true},{left:'$', right:'$', display:false}]});"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f9fafb; --panel:#ffffff; --muted:#4b5563; --text:#111827;
  --accent:#0ea5e9; --border:#e5e7eb; --card:#ffffff;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui,-apple-system,sans-serif}
a{color:var(--accent);text-decoration:none;transition:color 0.2s}
a:hover{text-decoration:underline}

/* ã€ä¿®æ”¹ã€‘æ ‡é¢˜é“¾æ¥çš„ç‰¹å®šæ ·å¼ */
.title-link {
  color: var(--text); /* é»˜è®¤æ˜¾ç¤ºé»‘è‰²/æ·±è‰² */
  text-decoration: none;
}
.title-link:hover {
  color: var(--accent); /* æ‚¬åœå˜è“ */
  text-decoration: underline;
}

.container{max-width:1080px;margin:0 auto;padding:24px}
header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);z-index:10}
.nav{display:flex;align-items:center;justify-content:space-between}
.brand{font-weight:800}
.menu{display:flex;gap:14px}
.menu a{padding:10px 12px;border-radius:10px;color:var(--text)}
.menu a:hover{background:rgba(0,0,0,.05)}
.hero{padding:50px 0 30px}
.hero h1{font-size:36px;margin:10px 0}
.btn{padding:8px 14px;border-radius:8px;background:var(--accent);color:#fff;border:none;cursor:pointer;font-size:14px}
.btn.secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
section{padding:30px 0;border-top:1px solid var(--border)}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,0.03)}
.flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.muted{color:var(--muted)}
.pill{padding:2px 8px;border-radius:4px;background:var(--bg);border:1px solid var(--border);font-size:12px;color:var(--accent)}
input{padding:8px;border:1px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text)}

/* æ·±è‰²æ¨¡å¼ */
[data-theme="dark"]{
  --bg:#0b1220; --panel:#0e1627; --muted:#94a3b8; --text:#f1f5f9;
  --accent:#38bdf8; --border:#1e293b; --card:#0f172a;
}
[data-theme="dark"] header{background:rgba(15,23,42,.8)}
[data-theme="dark"] .title-link {color: var(--text);}
[data-theme="dark"] .title-link:hover {color: var(--accent);}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="brand">Social Radar</div>
    <nav class="menu">
      <a href="#results">å­¦è€…åˆ†æ</a>
      <a href="#analyze">CSVå·¥å…·</a>
      <a href="#papers">è®ºæ–‡</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <h1>ç¤¾ä¼šé›·è¾¾ï¼šå­¦è€…å½±å“åŠ›æ„ŸçŸ¥</h1>
    <p class="muted">Social Sensing & Doppler Analysis Prototype</p>
  </section>

  <section id="results">
    <div class="flex" style="justify-content:space-between; margin-bottom:15px;">
      <h2>é¢†åŸŸå­¦è€… / æ´»è·ƒäººç‰©åˆ†æ</h2>
      <input id="kwFilter" placeholder="è¾“å…¥å…³é”®è¯ç­›é€‰ (å¦‚: è‡ªåŠ¨é©¾é©¶)..." style="width:240px">
    </div>

    <div class="card" style="margin-bottom: 20px;">
      <div style="position: relative; height: 300px; width: 100%;">
        <canvas id="authorChart"></canvas>
      </div>
    </div>

    <div class="card">
      <div class="flex" style="justify-content:space-between; border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:10px;">
        <span class="muted" id="resultsMeta">Loading data...</span>
      </div>
      <div id="resultsList"></div>
    </div>
  </section>

  <section id="analyze">
    <h2>CSV é¢‘ç§»æ¨¡æ‹Ÿ</h2>
    <div class="card">
      <p class="muted">ä¸Šä¼ è‡ªå®šä¹‰æ•°æ®è¿›è¡Œå¤šæ™®å‹’è®¡ç®—</p>
      <input id="file" type="file" accept=".csv" style="margin-bottom:10px">
      <canvas id="chart" width="1024" height="200" style="width:100%; border-radius:8px; background:var(--bg)"></canvas>
    </div>
  </section>
</main>

<script>
// ================= å…¨å±€é…ç½® =================
let authorChartInstance = null;

// ================= æ•°æ®è·å– =================
async function fetchJson(url){
  const res = await fetch(url + "?t=" + Date.now());
  if(!res.ok) throw new Error("404");
  return await res.json();
}

function escapeHtml(s){ return (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;"); }

// ================= å›¾è¡¨æ ¸å¿ƒé€»è¾‘ =================
function updateChart(rows) {
  const counts = {};
  rows.forEach(r => {
    const name = r.author ? r.author.trim() : "åŒ¿å";
    counts[name] = (counts[name] || 0) + 1;
  });

  const sortedData = Object.entries(counts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 12);

  const labels = sortedData.map(d => d[0]);
  const values = sortedData.map(d => d[1]);

  const style = getComputedStyle(document.documentElement);
  const color = style.getPropertyValue('--accent').trim();
  const txtColor = style.getPropertyValue('--muted').trim();

  const ctx = document.getElementById('authorChart').getContext('2d');
  if (authorChartInstance) authorChartInstance.destroy();

  authorChartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'å­¦è€…äº§å‡º / æåŠæ•°',
        data: values,
        backgroundColor: color,
        borderRadius: 4,
        barPercentage: 0.6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true, labels: { color: txtColor } },
        tooltip: {
          callbacks: {
            title: (items) => `å­¦è€…ï¼š${items[0].label}`,
            label: (item) => ` ç›¸å…³åŠ¨æ€ï¼š${item.raw} æ¡`
          }
        }
      },
      scales: {
        x: {
          ticks: { color: txtColor, autoSkip: false, maxRotation: 45, minRotation: 0 },
          grid: { display: false },
          title: { 
            display: true,
            text: 'å­¦è€…å§“å',
            color: txtColor,
            font: { size: 13, weight: 'bold' }
          }
        },
        y: {
          ticks: { color: txtColor, stepSize: 1 },
          grid: { color: style.getPropertyValue('--border').trim() },
          title: { 
            display: true,
            text: 'å‡ºç°é¢‘æ¬¡',
            color: txtColor
          }
        }
      }
    }
  });
}

// ================= åˆ—è¡¨æ¸²æŸ“ (ã€æ ¸å¿ƒä¿®æ”¹ã€‘ï¼šå®ç°è·³è½¬) =================
function renderRows(rows){
  const list = document.getElementById("resultsList");
  const kw = document.getElementById("kwFilter").value.trim().toLowerCase();
  
  const filtered = kw ? rows.filter(r => 
    (r.title+r.author+r.keyword).toLowerCase().includes(kw)
  ) : rows;

  updateChart(filtered);

  list.innerHTML = filtered.slice(0, 30).map(r => {
    // ã€ä¿®æ”¹ç‚¹ã€‘ å°è¯•è·å– url, link æˆ– question_url å­—æ®µï¼Œå¦‚æœéƒ½æ²¡æœ‰åˆ™ä¸º #
    const targetUrl = r.url || r.link || r.question_url || "#";
    
    return `
    <div style="padding:10px 0; border-bottom:1px solid var(--border)">
      <div style="font-weight:700; margin-bottom:4px; font-size:16px;">
        <a href="${targetUrl}" target="_blank" rel="noopener noreferrer" class="title-link">
          ${escapeHtml(r.title)}
        </a>
      </div>
      <div class="muted" style="font-size:12px">
        <span class="pill" style="margin-right:6px">ğŸ‘¤ ${escapeHtml(r.author)}</span>
        <span>Topic: ${escapeHtml(r.keyword)}</span>
        <span style="float:right">ğŸ‘ ${r.upvotes}</span>
      </div>
      ${r.excerpt ? `<div style="margin-top:6px; font-size:14px; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${escapeHtml(r.excerpt)}</div>` : ''}
    </div>
  `}).join("");
  
  if(filtered.length === 0) {
    list.innerHTML = `<div style="padding:20px; text-align:center;" class="muted">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ•°æ®</div>`;
  }
}

// ================= åˆå§‹åŒ– =================
async function init(){
  try {
    // ã€ä¿®æ”¹ç‚¹ã€‘æ¨¡æ‹Ÿæ•°æ®ä¸­åŠ å…¥äº†çœŸå®çš„çŸ¥ä¹ URL ç»“æ„ï¼Œæ–¹ä¾¿æµ‹è¯•
    const mockData = [
      {title:"è‡ªåŠ¨é©¾é©¶æ„ŸçŸ¥ç»¼è¿°ï¼šä»çº¯è§†è§‰åˆ°å¤šæ¨¡æ€èåˆ", author:"ç‹å­¦è€…", keyword:"CV", upvotes:200, url:"https://www.zhihu.com/search?type=content&q=è‡ªåŠ¨é©¾é©¶"},
      {title:"å¤§æ¨¡å‹ï¼ˆLLMï¼‰åœ¨è®¡ç®—ç¤¾ä¼šå­¦ä¸­çš„åº”ç”¨å‰æ™¯", author:"ææ•™æˆ", keyword:"LLM", upvotes:150, url:"https://www.zhihu.com/search?type=content&q=LLM"},
      {title:"Social Radar: å¦‚ä½•åˆ©ç”¨ç¤¾ä¼šæ„ŸçŸ¥æŠ€æœ¯é¢„æµ‹èˆ†æƒ…ï¼Ÿ", author:"SocialRadar Team", keyword:"Hardware", upvotes:300, url:"https://github.com"},
      {title:"æ·±åº¦å¼ºåŒ–å­¦ä¹ åœ¨æ— äººè½¦å†³ç­–ä¸­çš„æŒ‘æˆ˜", author:"å¼ åšå£«", keyword:"RL", upvotes:80, url:"https://www.zhihu.com"},
      {title:"Transformer å˜ä½“ç ”ç©¶ä¸æ€§èƒ½å¯¹æ¯”", author:"ç‹å­¦è€…", keyword:"NLP", upvotes:120, url:"https://www.zhihu.com"},
      {title:"æœªæ¥æ™ºèƒ½äº¤é€šç³»ç»Ÿ(ITS)çš„æ¼”è¿›è·¯çº¿", author:"èµµç ”ç©¶å‘˜", keyword:"ITS", upvotes:90, url:"https://www.zhihu.com"},
      {title:"ç”Ÿæˆå¼ AI çš„ä¼¦ç†ä¸ç¤¾ä¼šå½±å“", author:"ææ•™æˆ", keyword:"Ethics", upvotes:210, url:"https://www.zhihu.com"}
    ];

    let rows = mockData;
    try {
      const meta = await fetchJson("./data/meta.json");
      document.getElementById("resultsMeta").textContent = `æ•°æ®æ›´æ–°äº: ${meta.updated_at}`;
      rows = await fetchJson("./data/zhihu_data.json");
    } catch(e) { console.log("ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®..."); }

    renderRows(rows);
    document.getElementById("kwFilter").addEventListener("input", ()=>renderRows(rows));
    
  } catch(e) { alert("åˆå§‹åŒ–é”™è¯¯"); }
}

// ä¸»é¢˜åˆ‡æ¢é€»è¾‘
(function(){
  const btn = document.createElement('button');
  btn.textContent = "ğŸŒ“";
  btn.className = "btn secondary";
  btn.style.marginLeft="10px";
  btn.onclick = () => {
    const root = document.documentElement;
    const isDark = root.getAttribute('data-theme') === 'dark';
    root.setAttribute('data-theme', isDark ? 'light' : 'dark');
    init(); // é‡æ–°æ¸²æŸ“å›¾è¡¨
  };
  document.querySelector('.menu').appendChild(btn);
})();

init();
</script>
</body>
</html>
